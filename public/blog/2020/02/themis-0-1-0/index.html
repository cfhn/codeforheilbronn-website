<!DOCTYPE html>
<html>
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
<!DOCTYPE html>
<html lang="en-us">



<link rel="stylesheet" href="/css/fonts.css">
<link rel="stylesheet" href="/css/main-site.css">
<link rel="stylesheet" href="/css/fa5-all.css">
<style type="text/css">
    /* Google Fonts */


body {
	background-color: <no value>;
	color: <no value>;
}

/* Links */

a {
  color: <no value>;
}

a:hover {
  color: <no value>;
}

a:focus {
  outline-color: <no value>;
}

.column25-left .sectionTitle a:hover:not(.current),
.column16-left .sectionTitle a:hover:not(.current) { /* Tutorial left sidebar */
  color: <no value>;
}

.icon-attribution, 
.icon-attribution a {
  color: <no value>;
  opacity: 75%;
}


/* Landing page content bands */

#homeContent .band.first {
  background-color: <no value>;
}

#homeContent .band.second {
  background-color: <no value>;
}

#homeContent .band.third {
  background-color: <no value>;
}

/* Top navigation bar menu */

#rStudioHeader {
  background-color: <no value>;
  color: <no value>;
}

#rStudioHeader .productName {
  color: <no value>;
}

#rStudioHeader .productName:hover,
#rStudioHeader .productName:focus {
  color: <no value>;
}

#rStudioHeader #menu .menuItem.a {
  background-color: #75aadb;
  color: <no value>;
}

#rStudioHeader #menu .menuItem:hover {
  background-color: <no value>;
  color: <no value>;
}

#rStudioHeader #menu .menuItem.current {
  background-color: <no value>;
  color: <no value>;
  text-decoration: <no value>;
}

/* Footer */

#rStudioFooter.band {
  background-color: <no value>;
}

#rStudioFooter .bandContent #copyright {
  color: <no value>;
}

/* Tables */

table tbody tr:nth-child(even){
  background-color: <no value>;
}

table tbody tr:nth-child(odd){
  background-color: <no value>;
}

.latest {
  border-top: .5em solid <no value>;
}


/* ------Accent Font------- */





/* ----Accent color for headers, toc, etc.----- */



/* Custom colored bullets */



/* ------Capitalization of Headers------- */

  

/* -----Hexes------*/


/*----- Borders------ */



/*--- Event Stickies ---*/


















/* ------Test Drive Button-------*/














 

</style>




<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.147.2">
<title>themis 0.1.0</title>
<meta property="og:title" content="themis 0.1.0" />
<meta property="og:description" content="themis 0.1.0 is now available on CRAN. Provides additional steps for recipes to deal with unbalanced data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/blog/2020/02/themis-0-1-0/" />



<meta property="twitter:card" content="summary_large_image">





    <meta property="og:title" content="themis 0.1.0 - Education">
    <meta property="description" content="themis 0.1.0 is now available on CRAN. Provides additional steps for recipes to deal with unbalanced data.">
    <meta property="og:description" content="themis 0.1.0 is now available on CRAN. Provides additional steps for recipes to deal with unbalanced data.">

    
    
    
    
    
    
        <meta property="og:image" content="//localhost:1313/blog/2020/02/themis-0-1-0/thumb-sq.jpg" >
    

    
    
    
    
        <meta name="twitter:image" content="//localhost:1313/blog/2020/02/themis-0-1-0/thumb-wd.jpg" >
    





<link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png" />
<link rel="manifest" href="/images/favicons/site.webmanifest" />
<link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" />
<link rel="shortcut icon" href="/images/favicons/favicon.ico" />
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" href="/images/favicons/browserconfig.xml" >



<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/site.js"></script>








<link rel="icon" href="/images/favicon.ico" />


  
<script type="text/javascript" src="/js/clipboard.js"></script>






  


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

  







  <body>
    <div id="appTidyverseSite" class="shrinkHeader alwaysShrinkHeader">
      <div id="main">
        
        <div id="rStudioHeader">
          <div class="band">
            <div class="innards bandContent">
              <div>
                <a class="productName" href="/">Education</a>
                
              </div>
              <div id="menu">
  <div id="menuToggler"></div>
  <div id="menuItems" class="">
    
    
  </div>
</div>

            </div>
          </div>
        </div>
</head>
<body>


 




<div class="band padForHeader pushFooter">
  <div class="bandContent">
    <div class="full splitColumns withMobileMargins">
      <div class="column75">

      <h1 class="article-title">themis 0.1.0</h1>

      
      <div class="article-header" aria-hidden="true">
          
          <div class="photo">
          <img src='/blog/2020/02/themis-0-1-0/thumb-wd.jpg'>
          </div>
          
        
        <div class="photoCredit">Photo by <a href="https://unsplash.com/photos/RtDwtRDvYQg">Roman Kraft</a>
        </div>
        
      </div>

      
      <span class="article-date">
        <i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2020/02/11
      </span>
      
      
        <p style="margin-bottom: 0.5em; margin-top: 0.85em;">
          <i class="fas fa-tags"></i>&nbsp;
      
          
            <a href="/tags/tidymodels/">Tidymodels</a>, 
            <a href="/tags/themis/">Themis</a></p>
      
      
      
      
        <p style="margin-top: 0.5em;">
        <i class="fas fa-user-circle fa-fw"></i>&nbsp;
        




  

  Emil Hvitfeldt
  



      
        </p>
      

      <div class="article-content">
      <p>We&rsquo;re chuffed to announce the release of 
<a href="https://github.com/tidymodels/themis" target="_blank" rel="noopener">themis</a> on CRAN. 
<a href="https://tidymodels.github.io/themis/" target="_blank" rel="noopener">themis</a> implements a collection of new steps for the 
<a href="https://github.com/tidymodels/recipes" target="_blank" rel="noopener">recipes</a> package to deal with unbalanced data. themis is still in early development so any and all feedback is highly appreciated.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">library</span>(modeldata)
</span></span><span style="display:flex;"><span><span style="color:#00f">library</span>(recipes)
</span></span><span style="display:flex;"><span><span style="color:#00f">library</span>(themis)
</span></span></code></pre></div><p>In a classification context, a dataset is said to be unbalanced if there is an unequal number of observations in each class. Many models perform best when the number of observations is equal and, thus, tend to struggle with unbalanced data.</p>
<p>The steps in this package can be divided into two camps:</p>
<ul>
<li>Ones that remove observations from the majority class(es), and</li>
<li>Ones that add observations to the minority class(es).</li>
</ul>
<p>You can do more than one action, and, thus, are able to mix and match by for example first removing observations from the majority class followed by adding observations to the minority class to achieve the balance you want.</p>




<h2 id="hybrid-sampling-steps">Hybrid-sampling steps
  <a href="#hybrid-sampling-steps">
    <svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg>
  </a>
</h2><p>Hybrid-sampling involves adding observations to the minority class. This can be done in multiple ways, one way is to sample existing data points like <code>step_upsample()</code> does, another way is to synthetically generate new points based on existing points, <code>step_smote()</code> and related steps uses k nearest neighbor information to generate new points. Currently <code>step_upsample()</code>, <code>step_smote()</code>, <code>step_bsmote()</code>, <code>step_adasyn()</code>, and <code>step_rose()</code> are available. All steps have references in their respective help pages. They have slightly different requirements according to the data they can handle; most need all numeric with no missing data, but those requirements can and should be handled by previous steps.</p>
<p>In the following example, let&rsquo;s look at the <code>okc</code> dataset. and we can see that the imbalance is 1-to-6.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">data</span>(<span style="color:#ba2121">&#34;okc&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">table</span>(okc<span style="color:#666">$</span>Class)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  stem other </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9539 50316</span>
</span></span></code></pre></div><p>We will use <code>age</code>, <code>diet</code> and <code>height</code> in modeling to predict <code>Class</code>. Since <code>diet</code> is a factor, we first need to dummify it before we normalize and perform mean imputation to handle all the missing data.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>rec <span style="color:#666">&lt;-</span> <span style="color:#00f">recipe</span>(Class <span style="color:#666">~</span> age <span style="color:#666">+</span> diet <span style="color:#666">+</span> height, data <span style="color:#666">=</span> okc) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_unknown</span>(diet) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_dummy</span>(diet) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_normalize</span>(<span style="color:#00f">all_predictors</span>()) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_meanimpute</span>(<span style="color:#00f">all_predictors</span>()) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_smote</span>(Class) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rec <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">prep</span>() <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">juice</span>() <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">pull</span>(Class) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">table</span>()
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; .</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  stem other </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 50316 50316</span>
</span></span></code></pre></div><p>And we see that the resulting dataset has a perfectly even distribution. All the hybrid-sampling steps share the parameter <code>over_ratio</code>, which specifies the desired ratio between the biggest class and the smallest class. It defaults to 1 for an even distribution but can be set to something like <code>0.5</code> to have the minority class become half the size of the majority class.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>rec <span style="color:#666">&lt;-</span> <span style="color:#00f">recipe</span>(Class <span style="color:#666">~</span> age <span style="color:#666">+</span> diet <span style="color:#666">+</span> height, data <span style="color:#666">=</span> okc) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_unknown</span>(diet) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_dummy</span>(diet) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_normalize</span>(<span style="color:#00f">all_predictors</span>()) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_meanimpute</span>(<span style="color:#00f">all_predictors</span>()) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_smote</span>(Class, over_ratio <span style="color:#666">=</span> <span style="color:#666">0.5</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rec <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">prep</span>() <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">juice</span>() <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">pull</span>(Class) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">table</span>()
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; .</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  stem other </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 25158 50316</span>
</span></span></code></pre></div>



<h2 id="under-sampling-steps">Under-sampling steps
  <a href="#under-sampling-steps">
    <svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg>
  </a>
</h2><p>Under-sampling is removing observations from the majority class. Currently <code>step_downsample()</code>, <code>step_nearmiss()</code> and <code>step_tomek()</code> are available. These steps should have the same user experience as the previous steps as they have a similar shared parameter <code>under_ratio</code> which is the ratio between the smallest and the biggest class. Simply using <code>step_downsample()</code> randomly removes samples in the majority classes to get them to be the same size as the smallest class.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>rec <span style="color:#666">&lt;-</span> <span style="color:#00f">recipe</span>(Class <span style="color:#666">~</span> age <span style="color:#666">+</span> diet <span style="color:#666">+</span> height, data <span style="color:#666">=</span> okc) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_unknown</span>(diet) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_dummy</span>(diet) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_normalize</span>(<span style="color:#00f">all_predictors</span>()) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_meanimpute</span>(<span style="color:#00f">all_predictors</span>()) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_downsample</span>(Class) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rec <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">prep</span>() <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">juice</span>() <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">pull</span>(Class) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">table</span>()
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; .</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  stem other </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9539  9539</span>
</span></span></code></pre></div>
      </div>


      

      </div> 
      
      <div class="column25">
        <div class="section hideOnMobile">
          
          <div class="sectionTitle">Contents</div>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#hybrid-sampling-steps">Hybrid-sampling steps</a></li>
    <li><a href="#under-sampling-steps">Under-sampling steps</a></li>
  </ul>
</nav>
          
        </div>
        <div class="section">
          





        </div>
      </div> 

    </div> 
  </div>  
</div> 



        <div id="rStudioFooter" class="band">
          <div class="bandContent">
            <div id="copyright">
              
              
            </div>
            <div id="logos">
              <a href="" class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a>
              <a href="" class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a>
            </div>
          </div>
        </div>

      </div>  
    </div>  

    




<script src="//cdn.bootcss.com/highlight.js//highlight.min.js"></script>



<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>




    
<script src="/js/math-code.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    

  </body>
</html>

</body>
</html>
